# Cесії у Node.js

У Node.js сесія забезпечує механізм збереження стану клієнта між кількома HTTP-запитами. На відміну від cookies, які зберігаються на стороні клієнта, сесії зберігаються на стороні сервера, що робить їх придатними для збереження чутливих даних, таких як статус автентифікації користувача або вміст кошика.

## Як працюють сесії у Node.js (зазвичай з Express.js):

### 1. Ініціалізація
   Коли клієнт уперше взаємодіє з сервером (наприклад, входить у систему), сервер створює унікальний ідентифікатор сесії (session ID).

### 2. Збереження даних сесії
   Цей session ID асоціюється з об’єктом сесії на сервері, де зберігаються дані, специфічні для користувача. Дані можуть зберігатися:

- у памʼяті (для розробки або невеликих проєктів),

- в персистентному сховищі (наприклад, MongoDB, Redis), щоб не втрачалися при перезапуску сервера.

### 3. Передача cookie
   Сервер надсилає клієнту cookie, яке містить цей session ID.

### 4. Наступні запити
   При кожному наступному запиті браузер автоматично відправляє cookie з session ID назад на сервер.

### 5. Отримання сесії
   Сервер за отриманим session ID знаходить відповідні дані у сховищі. Таким чином він ідентифікує користувача і отримує його дані.

### 6. Закінчення або знищення сесії
   Сесія може:
   
-завершуватись через неактивність,

- або бути знищеною вручну (наприклад, під час виходу з системи), що призводить до очищення сесії на сервері та видалення cookie на клієнті.

## Приклад реалізації сесій у Node.js за допомогою Express.js
```js
const express = require('express');
const session = require('express-session');
const app = express();

app.use(session({
  secret: 'your_secret_key',          // Секрет для підпису cookie
  resave: false,                      // Не зберігати сесію без змін
  saveUninitialized: false,          // Не створювати порожні сесії
  cookie: { maxAge: 60 * 60 * 1000 } // Тривалість сесії — 1 година
}));

// Приклад використання
app.get('/', (req, res) => {
  if (req.session.views) {
    req.session.views++;
    res.send(`Ви відвідали цю сторінку ${req.session.views} раз(ів).`);
  } else {
    req.session.views = 1;
    res.send('Ласкаво просимо на сторінку вперше!');
  }
});

app.listen(3000, () => {
 console.log('Сервер працює на порту 3000');
});

```

## Важливі моменти

***Безпека***: Використовуйте надійний унікальний secret для підпису cookies.

***Сховище сесій***: У production-середовищі використовуйте персистентні сховища.

***Тривалість сесії***: Коректно налаштуйте maxAge, щоб керувати часом життя сесії та безпекою.

# Життєвий цикл

```angular2html
Клієнт  ──>  Сервер: Перший запит (наприклад, логін)
               │
               │  Сервер створює унікальний session ID
               │
               ▼
         Сервер зберігає session ID + дані користувача (в памʼяті чи БД)
               │
               │
               ▼
         Сервер відправляє клієнту cookie з session ID
               │
               ▼
         Клієнт зберігає cookie (session ID)
               │
 ┌─────────────┴─────────────┐
 │                           │
 ▼                           ▼
Клієнт                  Клієнт
робить                 робить
наступний             наступний
запит                 запит
  │                       │
  └───> Відправляє cookie із session ID ───────┘
                │
                ▼
      Сервер отримує cookie з session ID
                │
                ▼
      Сервер шукає відповідні дані сесії у сховищі
                │
                ▼
      Сервер ідентифікує користувача та отримує дані
                │
                ▼
      Сервер обробляє запит, використовуючи дані сесії
                │
                ▼
       ┌──────────────────────────────────────────────┐
       │                                              │
       ▼                                              ▼
  Сесія закінчується або                       Сесія активна,
  користувач виходить                          сервер продовжує обробку
  (сесія видаляється,                          запитів із сесією
  cookie видаляється)

```